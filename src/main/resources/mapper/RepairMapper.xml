<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.shu.carsystem.mapper.RepairMapper">
    <!-- List<Vehicle> getListByUId(Integer id); -->
    <resultMap id="RepairMap" type="Repair">
        <id property="repairId" column="repair_id"></id>
        <result property="type" column="type"></result>
        <result property="classification" column="classification"></result>
        <result property="payment" column="payment"></result>
        <result property="mile" column="mile"></result>
        <result property="fuel" column="fuel"></result>
        <result property="approachTime" column="approach_time"></result>
        <result property="failure" column="failure"></result>
        <result property="ddl" column="ddl"></result>
        <result property="cost" column="cost"></result>
        <result property="userId" column="user_id"></result>
        <result property="vehicleId" column="vehicle_id"></result>
        <result property="hour" column="hour"></result>
        <result property="maintainerId" column="maintainer_id"></result>
        <result property="statu" column="statu"></result>
    </resultMap>
    <!-- List<Repair> getListByUId(Integer id); -->
    <select id="getListByUID" resultMap="RepairMap">
        select * from "repair"
        <where>
            user_id = #{id};
        </where>
    </select>

    <!-- Repair getRepairByVehicleId(Integer vehicleId); -->
    <select id="getRepairByVehicleId" resultType="Repair">
        select * from repair where vehicle_id = #{vehicleId};
    </select>

    <!-- int insertClientRepair(Repair repair); -->
    <insert id="insertClientRepair" useGeneratedKeys="true" keyProperty="repairId">
        <selectKey keyProperty="repairId" resultType="Integer" order="BEFORE">
            select (select max(repair_id) from repair)+1 as repair_id;
        </selectKey>
        insert into "repair" values (#{repairId},#{type},#{classification},#{payment},#{mile},#{fuel},#{approachTime},#{failure},#{ddl},#{cost},#{userId},#{vehicleId},#{hour},#{maintainerId},#{statu})
    </insert>

    <!--    List<Repair> showOrderToReceive();-->
    <select id="showOrderToReceive" resultType="Repair">
        select * from repair where user_id is null;
    </select>

    <!--List<Repair> showOrderInProgress();-->
    <select id="showOrderInProgress" resultType="Repair">
        select * from repair where user_id is not null;
    </select>

    <!--    int updateRepairByRepairId(@Param("userId") Integer userId,@Param("repairId") Integer repairId);-->
    <update id="updateRepairByRepairId">
        update repair set user_id = #{userId} where repair_id=#{repairId};
    </update>

</mapper>