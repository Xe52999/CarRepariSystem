<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.shu.carsystem.mapper.MaintainMapper">

    <!-- int insertMaintain(Maintain maintain); -->
    <insert id="insertMaintain">
        insert into maintain values (#{repairId},#{repairmanId},#{proId},,#{userId})
    </insert>

    <resultMap id="NotEnsuredRepairsMap" type="com.shu.carsystem.pojo.NotEnsuredRepair">
        <result property="repairId" column="repair_id"></result>
        <result property="license" column="license"></result>
        <result property="vin" column="vin"></result>
        <result property="proId" column="pro_id"></result>
        <result property="pname" column="pname"></result>
        <result property="failure" column="failure"></result>
    </resultMap>

    <!-- List<NotEnsuredRepair> getNotEnsuredRepairs(Integer userId, String keyWord); -->
    <select id="getNotEnsuredRepairs" resultMap="NotEnsuredRepairsMap">
        select * from maintain,project,vehicle,repair
        <where>
            maintain.repair_id = repair.repair_id and maintain.pro_id = project.pro_id and repair.vehicle_id = vehicle.vehicle_id
            and maintain.repairman_id = #{userId} and maintain.isfinished = '待确认'
            <if test="keyWord != 'null' or keyWord != ''">
                and (repair_id like '%${keyword}%' or license like '%${keyword}%' or vin like '%${keyword}%' or pro_id like '%${keyword}%' or pname like '%${keyword}%' or failure like '%${keyword}%');
            </if>
        </where>
    </select>
</mapper>